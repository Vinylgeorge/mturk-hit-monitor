<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MTurk Queue Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f8fa; margin: 0; padding: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    thead th { background: #fff; position: sticky; top: 0; border-bottom: 1px solid #ccc; padding: 8px; text-align: left; }
    tbody td { padding: 8px; border-bottom: 1px solid #eee; }
    tbody tr:hover { background: #f9fbff; }
    .small { font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <h1>MTurk Queue (from JSONBin)</h1>
  <div id="tableContainer">Loadingâ€¦</div>

  <script>
    const BIN_ID = "68c89a4fd0ea881f407f25c0";
    const API_KEY = "$2a$10$tGWSdPOsZbt7ecxcUqPwaOPrtBrw84TrZQDZtPvWN5Hpm595sHtUm";
    const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    function fmtReward(v){ return v == null ? "-" : `$${Number(v).toFixed(2)}`; }
    function fmtTimeRemaining(sec){ if (!sec) return "-"; const m=Math.floor(sec/60),s=sec%60; return `${m}m ${s}s`; }
    function fmtAcceptedAt(iso){ if(!iso) return "-"; try{ return new Date(iso).toLocaleString(); }catch(e){return iso;} }

    async function fetchBin(){
      const headers = API_KEY ? { "X-Master-Key": API_KEY } : {};
      const res = await fetch(BIN_URL, { headers, cache:"no-store" });
      const js = await res.json();
      let hits = js?.record ?? [];
      if (!Array.isArray(hits)) hits = hits.record ?? [];

      if (!Array.isArray(hits) || hits.length === 0) {
        document.getElementById("tableContainer").innerHTML = `<p>No data.</p>`;
        return;
      }

      let html = `<table><thead>
        <tr><th>Requester</th><th>Title</th><th>Reward</th><th>Worker ID</th><th>Time Remaining</th><th>Accepted At</th></tr>
      </thead><tbody>`;

      for (const hit of hits) {
        html += `<tr>
          <td>${hit.requester}</td>
          <td>${hit.title}</td>
          <td>${fmtReward(hit.reward)}</td>
          <td>${hit.workerId}</td>
          <td class="small">${fmtTimeRemaining(hit.timeRemainingSeconds)}</td>
          <td class="small">${fmtAcceptedAt(hit.acceptedAt)}</td>
        </tr>`;
      }

      html += `</tbody></table>`;
      document.getElementById("tableContainer").innerHTML = html;
    }

    setInterval(fetchBin, 10000);
    fetchBin();
  </script>
</body>
</html>
